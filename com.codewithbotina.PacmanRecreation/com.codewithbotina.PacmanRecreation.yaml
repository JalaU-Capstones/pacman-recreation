app-id: com.codewithbotina.PacmanRecreation
runtime: org.freedesktop.Platform
runtime-version: '24.08'
sdk: org.freedesktop.Sdk
sdk-extensions:
  - org.freedesktop.Sdk.Extension.dotnet9
command: pacman-recreation

finish-args:
  - --share=ipc
  - --share=network
  - --socket=wayland
  - --socket=x11
  - --device=dri
  - --socket=pulseaudio
  - --filesystem=xdg-data/pacman-recreation:create
  - --device=all

modules:
  - name: flac
    buildsystem: autotools
    sources:
      - type: archive
        url: https://downloads.xiph.org/releases/flac/flac-1.3.4.tar.xz
        sha256: 8ff0607e75a322dd7cd6ec48f4f225471404ae2730d0ea945127b1355155e737

  - name: dotnet
    buildsystem: simple
    build-commands:
      - mkdir -p /app/lib/dotnet
      - mkdir -p /app/bin
      - cp -r dotnet/sdk dotnet/host dotnet/shared dotnet/dotnet /app/lib/dotnet/
      - ln -sf /app/lib/dotnet/dotnet /app/bin/dotnet
    sources:
      - type: archive
        url: https://dotnetcli.azureedge.net/dotnet/Sdk/9.0.200/dotnet-sdk-9.0.200-linux-x64.tar.gz
        sha256: c07281a0abbd2c3200e70fc94d374baeadfbb43c9c3fe90c6038253555b84335
        dest: dotnet
    cleanup:
      - /lib/dotnet/sdk/*/Sdks/Microsoft.NET.Sdk.WebAssembly.Pack

  - name: pacman-recreation
    buildsystem: simple
    build-options:
      build-args:
        - --share=network
    build-commands:
      - dotnet publish src/PacmanGame/PacmanGame.csproj -c Release -r linux-x64 --self-contained -o /app/bin
      - install -Dm644 com.codewithbotina.PacmanRecreation.desktop /app/share/applications/com.codewithbotina.PacmanRecreation.desktop
      - install -Dm644 com.codewithbotina.PacmanRecreation.metainfo.xml /app/share/metainfo/com.codewithbotina.PacmanRecreation.metainfo.xml
      - install -Dm644 icons/64x64/com.codewithbotina.PacmanRecreation.png /app/share/icons/hicolor/64x64/apps/com.codewithbotina.PacmanRecreation.png
      - install -Dm644 icons/128x128/com.codewithbotina.PacmanRecreation.png /app/share/icons/hicolor/128x128/apps/com.codewithbotina.PacmanRecreation.png
      - install -Dm644 icons/256x256/com.codewithbotina.PacmanRecreation.png /app/share/icons/hicolor/256x256/apps/com.codewithbotina.PacmanRecreation.png
      - install -Dm644 icons/512x512/com.codewithbotina.PacmanRecreation.png /app/share/icons/hicolor/512x512/apps/com.codewithbotina.PacmanRecreation.png
      - mkdir -p /app/share/pacman-recreation
      - cp -r src/PacmanGame/Assets /app/share/pacman-recreation/
      # Create a wrapper script to launch the game with correct library path
      - echo '#!/bin/sh' > /app/bin/pacman-recreation
      - echo 'export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/app/bin:/app/lib' >> /app/bin/pacman-recreation
      - echo 'exec /app/bin/PacmanGame "$@"' >> /app/bin/pacman-recreation
      - chmod +x /app/bin/pacman-recreation
      # Workaround for missing appstream-compose in SDK 24.08
      - echo '#!/bin/sh' > /app/bin/appstream-compose
      - echo 'exit 0' >> /app/bin/appstream-compose
      - chmod +x /app/bin/appstream-compose
    sources:
      - type: git
        url: https://github.com/JalaU-Capstones/pacman-recreation.git
        tag: v1.0.0
      - type: file
        path: com.codewithbotina.PacmanRecreation.desktop
      - type: file
        path: com.codewithbotina.PacmanRecreation.metainfo.xml
      - type: file
        path: icons/64x64/com.codewithbotina.PacmanRecreation.png
      - type: file
        path: icons/128x128/com.codewithbotina.PacmanRecreation.png
      - type: file
        path: icons/256x256/com.codewithbotina.PacmanRecreation.png
      - type: file
        path: icons/512x512/com.codewithbotina.PacmanRecreation.png
