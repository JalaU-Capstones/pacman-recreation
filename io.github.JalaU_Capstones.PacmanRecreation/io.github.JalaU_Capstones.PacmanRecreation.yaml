app-id: io.github.JalaU_Capstones.PacmanRecreation
runtime: org.freedesktop.Platform
runtime-version: '24.08'
sdk: org.freedesktop.Sdk
sdk-extensions:
  - org.freedesktop.Sdk.Extension.dotnet9
command: pacman-recreation

build-options:
  append-path: /usr/lib/sdk/dotnet9/bin
  append-ld-library-path: /usr/lib/sdk/dotnet9/lib
  env:
    PKG_CONFIG_PATH: /app/lib/pkgconfig:/usr/lib/pkgconfig:/usr/share/pkgconfig
    DOTNET_CLI_TELEMETRY_OPTOUT: '1'
    DOTNET_NOLOGO: '1'
    DOTNET_SKIP_FIRST_TIME_EXPERIENCE: '1'
    HOME: /root

finish-args:
  - --share=network
  - --socket=wayland
  - --socket=fallback-x11
  - --share=ipc
  - --device=dri
  - --socket=pulseaudio
  - --filesystem=xdg-data/pacman-recreation:create

modules:
  - name: pacman-recreation
    buildsystem: simple
    build-commands:
      # This is the canonical pattern used by all .NET apps on Flathub.
      # --source ./nuget-sources includes BOTH app packages AND runtime packs.
      # Runtime packs (Microsoft.NETCore.App.Runtime.linux-x64, etc.) must be
      # present in nuget-sources â€” generate them with generate-nuget-sources.py.
      - dotnet publish src/PacmanGame/PacmanGame.csproj
        -c Release
        -r linux-x64
        --self-contained true
        --source ./nuget-sources
        -o /app/lib/pacman-recreation
        /p:PublishSingleFile=false
        /p:DebugType=None
        /p:DebugSymbols=false

      # Create launcher script
      - |
        cat > /tmp/launcher.sh << 'LAUNCHER'
        #!/bin/bash
        export ASSETS_PATH=/app/share/pacman-recreation/Assets
        export XDG_DATA_HOME="${XDG_DATA_HOME:-$HOME/.local/share}"
        mkdir -p "$XDG_DATA_HOME/pacman-recreation"
        exec /app/lib/pacman-recreation/PacmanGame "$@"
        LAUNCHER
      - install -Dm755 /tmp/launcher.sh /app/bin/pacman-recreation

      # Install game assets
      - install -d /app/share/pacman-recreation
      - cp -r src/PacmanGame/Assets /app/share/pacman-recreation/

      # Install desktop integration
      - install -Dm644 io.github.JalaU_Capstones.PacmanRecreation.desktop
        /app/share/applications/io.github.JalaU_Capstones.PacmanRecreation.desktop
      - install -Dm644 io.github.JalaU_Capstones.PacmanRecreation.xml
        /app/share/metainfo/io.github.JalaU_Capstones.PacmanRecreation.metainfo.xml

      # Install icons
      - install -Dm644 icons/64x64/io.github.JalaU_Capstones.PacmanRecreation.png
        /app/share/icons/hicolor/64x64/apps/io.github.JalaU_Capstones.PacmanRecreation.png
      - install -Dm644 icons/128x128/io.github.JalaU_Capstones.PacmanRecreation.png
        /app/share/icons/hicolor/128x128/apps/io.github.JalaU_Capstones.PacmanRecreation.png
      - install -Dm644 icons/256x256/io.github.JalaU_Capstones.PacmanRecreation.png
        /app/share/icons/hicolor/256x256/apps/io.github.JalaU_Capstones.PacmanRecreation.png
      - install -Dm644 icons/512x512/io.github.JalaU_Capstones.PacmanRecreation.png
        /app/share/icons/hicolor/512x512/apps/io.github.JalaU_Capstones.PacmanRecreation.png

    sources:
      - type: git
        url: https://github.com/JalaU-Capstones/pacman-recreation.git
        tag: v1.0.0
        commit: 316f44acd330688a84130c6a7a56e2bc44d954f5

      - generated-sources.json
