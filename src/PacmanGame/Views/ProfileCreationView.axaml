<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:PacmanGame.ViewModels"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
             x:Class="PacmanGame.Views.ProfileCreationView"
             x:DataType="vm:ProfileCreationViewModel">

  <UserControl.Styles>
    <StyleInclude Source="/Styles/ButtonStyles.axaml" />

    <!-- Custom style for color picker buttons -->
    <Style Selector="Button.color-picker">
        <Setter Property="Width" Value="40"/>
        <Setter Property="Height" Value="40"/>
        <Setter Property="Margin" Value="5"/>
        <Setter Property="CornerRadius" Value="20"/>
    </Style>

    <Style Selector="Button.color-picker:pointerover">
        <Setter Property="Opacity" Value="0.8"/>
        <Setter Property="RenderTransform" Value="scale(1.1)"/>
    </Style>
  </UserControl.Styles>

  <Grid RowDefinitions="*,Auto,*" Background="Black">
    <StackPanel Grid.Row="1" HorizontalAlignment="Center" Spacing="20" Width="400">
      <TextBlock Text="CREATE PROFILE"
                 Classes="h1"
                 HorizontalAlignment="Center"
                 Foreground="#FFFF00"
                 FontFamily="{StaticResource ArcadeFont}"
                 FontSize="36"
                 Margin="0,0,0,20"/>

      <TextBlock Text="ENTER NAME:"
                 Foreground="White"
                 FontFamily="Consolas"
                 FontSize="18"/>

      <TextBox Text="{Binding Name}"
               Watermark="Player Name (3-15 chars)"
               MaxLength="15"
               FontFamily="Consolas"
               FontSize="20"/>

      <TextBlock Text="CHOOSE COLOR:"
                 Foreground="White"
                 FontFamily="Consolas"
                 FontSize="18"
                 Margin="0,10,0,0"/>

      <ItemsControl ItemsSource="{Binding AvailableColors}">
        <ItemsControl.ItemsPanel>
          <ItemsPanelTemplate>
            <WrapPanel HorizontalAlignment="Center" />
          </ItemsPanelTemplate>
        </ItemsControl.ItemsPanel>
        <ItemsControl.ItemTemplate>
          <DataTemplate>
            <Button Classes="color-picker"
                    Command="{Binding $parent[UserControl].((vm:ProfileCreationViewModel)DataContext).SelectColorCommand}"
                    CommandParameter="{Binding}"
                    Background="{Binding}">
              <Button.Styles>
                <!-- Override hover background to keep the color -->
                <Style Selector="Button:pointerover /template/ ContentPresenter">
                  <Setter Property="Background" Value="{Binding}" />
                </Style>
              </Button.Styles>
              <Panel>
                 <!-- Selection Indicator -->
                 <Border BorderBrush="White" BorderThickness="3" CornerRadius="20"
                         IsVisible="{Binding $parent[UserControl].((vm:ProfileCreationViewModel)DataContext).SelectedColor, Converter={x:Static ObjectConverters.Equal}, ConverterParameter={Binding}}" />
              </Panel>
            </Button>
          </DataTemplate>
        </ItemsControl.ItemTemplate>
      </ItemsControl>

      <TextBlock Text="{Binding ErrorMessage}"
                 Foreground="Red"
                 FontFamily="Consolas"
                 FontSize="14"
                 TextWrapping="Wrap"
                 HorizontalAlignment="Center"/>

      <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Spacing="20" Margin="0,20,0,0">
        <Button Classes="arcade"
                Command="{Binding CancelCommand}"
                Content="CANCEL" />
        <Button Classes="arcade"
                Command="{Binding CreateProfileCommand}"
                Content="CREATE" />
      </StackPanel>
    </StackPanel>
  </Grid>
</UserControl>
